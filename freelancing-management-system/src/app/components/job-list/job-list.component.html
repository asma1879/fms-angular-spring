<div class="container my-5">
  <h2 class="text-center mb-4 text-primary fw-bold">Browse Jobs</h2>

  <!-- Filters -->
  <div class="card p-4 shadow-sm mb-4 border-0">
    <div class="row g-3">
      <div class="col-md-4">
        <input
          type="text"
          class="form-control"
          placeholder="🔍 Search by title or keyword"
          [(ngModel)]="keyword"
          (input)="onFilterChange()" />
      </div>
      <div class="col-md-4">
        <select class="form-select" [(ngModel)]="selectedCategory" (change)="onFilterChange()">
          <option value="">📂 All Categories</option>
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
      </div>
      <div class="col-md-4">
        <select class="form-select" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
          <option value="">📌 All Statuses</option>
          <option value="OPEN">🟢 Open</option>
          <option value="CLOSED">🔴 Closed</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Jobs List -->
  <div class="row">
    <div class="col-12 mb-3" *ngFor="let job of paginatedJobs">
      <div class="card shadow-sm border-0 p-3">
        <h5 class="fw-bold text-dark mb-2" style="line-height: 2.3;">
          {{ job.title }}
          <span class="badge bg-info text-dark ms-2">{{ job.budgetType }}</span>
        </h5>

        <p class="text-muted small mb-3">{{ job.description | slice: 0:220 }}...</p>

        <div class="mb-2" style="line-height: 1.8;">
          <div><i class="bi bi-folder2-open text-success me-1"></i><strong>Category : </strong> {{ job.category }}</div>
          <div><i class="bi bi-cash-coin text-primary me-1"></i><strong>Budget : </strong> ${{ job.budget }} <small class="text-muted">({{ job.budgetType || 'Fixed' }})</small></div>
          <!-- <div><i class="bi bi-clock-history text-secondary me-1"></i><strong>Duration : </strong> {{ job.duration }} days</div> -->
          <div><i class="bi bi-calendar-event text-warning me-1"></i><strong>Deadline : </strong> {{ job.deadline }}</div>
          <div>
            <i class="bi bi-tools text-info me-1"></i><strong>Skills : </strong>
            <span class="badge bg-light text-dark border me-1" *ngFor="let skill of job.skillsRequired">{{ skill }}</span>
          </div>
          <div>
            <i class="bi bi-flag-fill text-secondary me-1"></i><strong>Status : </strong>
            <span [ngClass]="{
              'badge bg-warning': job.status === 'OPEN',
              'badge bg-danger': job.status === 'CLOSED'
            }">{{ job.status }}</span>
          </div>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-3">
          <button *ngIf="job.status !== 'CLOSED'" class="btn btn-outline-primary btn-sm" (click)="openBidModal(job.id)">
            <i class="bi bi-send-plus me-1"></i>Apply Now
          </button>
          <button *ngIf="job.status !== 'CLOSED'" class="btn btn-outline-secondary btn-sm" (click)="saveToWishlist(job)">
            <i class="bi bi-heart"></i> Add to Wishlist
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <nav class="d-flex justify-content-center mt-4" *ngIf="totalPages > 1">
    <ul class="pagination pagination-sm mb-0">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="changePage(currentPage - 1)">«</button>
      </li>
      <li
        class="page-item"
        *ngFor="let page of [].constructor(totalPages); let i = index"
        [class.active]="currentPage === (i + 1)">
        <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="changePage(currentPage + 1)">»</button>
      </li>
    </ul>
  </nav>
</div>

<!-- Bid Modal -->
<div class="modal fade" id="bidModal" tabindex="-1" aria-labelledby="bidModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form (ngSubmit)="submitBid()" #bidForm="ngForm" class="modal-content">
      <div class="modal-header bg-light">
        <h5 class="modal-title" id="bidModalLabel">💼 Apply for Job</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="clearBidForm()"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="bidMessage" class="form-label">Your Message</label>
          <textarea
            id="bidMessage"
            name="bidMessage"
            class="form-control"
            [(ngModel)]="bidMessage"
            required
            rows="4"></textarea>
        </div>
        <div class="mb-3">
          <label for="bidAmount" class="form-label">Bid Amount ($)</label>
          <input
            type="number"
            id="bidAmount"
            name="bidAmount"
            class="form-control"
            [(ngModel)]="bidAmount"
            required
            min="1" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" (click)="clearBidForm()">Close</button>
        <button type="submit" class="btn btn-success" [disabled]="bidForm.invalid">Submit Bid</button>
      </div>
    </form>
  </div>
</div>
